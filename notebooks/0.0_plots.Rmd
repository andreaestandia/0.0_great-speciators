---
title: "0.0_regression.Rmd"
author: "Andrea Estandia<br>"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  github_document:
  toc: true
toc_depth: 4
editor_options:
  chunk_output_type: console
---
  <br>
  
```{r setup, echo=FALSE}
# Knitr settings: 
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
options(scipen = 999)
```

```{r, echo=FALSE}
source("./src/0.0_great-speciators_source.R")
```

Open model results
```{r}
output_path = file.path(getwd(), "output")

load(file.path(output_path, "mod_world_res_log.RData"))

load(file.path(output_path, "mod_melanesia_res_log.RData"))
```


Open dfs - world + melanesia
```{r}
df_melanesia <- read_csv(file.path(data_path, "dfs", "0.2_melanesia.csv")) %>% 
  mutate(md = nsubsp/npoly) %>% 
 mutate(gsi = nsubsp/log(npoly)) %>% mutate(gsi=ifelse(gsi=="Inf",0,gsi)) %>% distinct(species_name,.keep_all = T)

df_melanesia$gsi <- stdize(df_melanesia$gsi)

df_world <- read_csv(file.path(data_path, "dfs", "world_0.2.csv")) %>% 
  mutate(md = nsubsp/npoly) %>% 
 mutate(gsi = nsubsp/log(npoly)) %>% mutate(gsi=ifelse(gsi=="Inf",0,gsi)) %>% distinct(species_name,.keep_all = T)

df_world$gsi <- stdize(df_world$gsi)

df_antilles <- read_csv(file.path(data_path, "dfs", "0.2_antilles.csv")) %>% 
  #filter(nsubsp>1) %>% filter(nsubsp<npoly) %>% 
  mutate(md = nsubsp/npoly) %>% 
 mutate(gsi = nsubsp/log(npoly)) %>% mutate(gsi=ifelse(gsi=="Inf",0,gsi)) %>% distinct(species_name,.keep_all = T)

df_antilles$gsi <- stdize(df_antilles$gsi)

df_hawaii <- read_csv(file.path(data_path, "dfs", "0.2_hawaii.csv")) %>% 
  #filter(nsubsp>1) %>% filter(nsubsp<npoly) %>% 
  mutate(md = nsubsp/npoly) %>% 
 mutate(gsi = nsubsp/log(npoly)) %>% mutate(gsi=ifelse(gsi=="Inf",0,gsi)) %>% distinct(species_name,.keep_all = T)

df_hawaii$gsi <- stdize(df_hawaii$gsi)
```

Create great speciator subset based on M&D rules 
```{r}
md_1 <- df_melanesia %>% filter(nsubsp<=npoly) %>%filter(nsubsp>=4) %>% filter(nsubsp <= 6) %>%  mutate(gsi = nsubsp/log(npoly)) %>% mutate(gsi=ifelse(gsi=="Inf",0,gsi)) %>% arrange(desc(gsi)) %>%mutate(md = nsubsp/npoly) %>% distinct(species_name,.keep_all = T) %>% filter( md>=0.33)

md_2 <- df_melanesia %>%filter(nsubsp>=7)%>%mutate(md = nsubsp/npoly) %>% mutate(gsi = nsubsp/log(npoly)) %>% mutate(gsi=ifelse(gsi=="Inf",0,gsi)) %>%  distinct(species_name,.keep_all = T) 

md_total_mel <- rbind(md_1,md_2)
```

Test for family distribution - Cullen Frey Graph
```{r}
descdist(mod_world_logit$data$norm_residual, boot=10000)
```

Nsubsp - histogram
```{r}
hist1 <- df_melanesia %>%
  ggplot(aes(x=nsubsp))+
  geom_histogram()+theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_text(vjust = 0.9,hjust=1),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(),
    axis.ticks.y = element_blank())+
  labs(title="Northern Melanesia\n", x="\nNumber of subspecies\n", y="\nCount\n")

hist2 <- df_world %>%
  ggplot(aes(x=nsubsp))+
  geom_histogram()+theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    #axis.text.x = element_blank(),
    axis.text.x = element_text(vjust = 0.9,hjust=1),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(),
    axis.ticks.y = element_blank())+
  labs(title="Global Island\n", x="\nNumber of subspecies\n", y="\nCount\n")

hist3 <- df_antilles %>%
  ggplot(aes(x=nsubsp))+
  geom_histogram()+theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    #axis.text.x = element_blank(),
    axis.text.x = element_text(vjust = 0.9,hjust=1),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(),
    axis.ticks.y = element_blank())+
  labs(title="Antilles\n", x="\nNumber of subspecies\n", y="\nCount\n")

hist4 <- df_hawaii %>%
  ggplot(aes(x=nsubsp))+
  geom_histogram()+theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    #axis.text.x = element_blank(),
    axis.text.x = element_text(vjust = 0.9,hjust=1),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(),
    axis.ticks.y = element_blank())+
  labs(title="Hawaii\n", x="\nNumber of subspecies\n", y="\nCount\n")

hist_nsubsp <-hist2/ hist1 / hist3 / hist4

ggsave(
  plot=hist_nsubsp,
  filename = "hist_nsubsp.pdf",
  path = figures_path,
  device="pdf",
  scale=0.5,
  width = 30,
  height = 70,
  dpi = 400,
  units = "cm"
)
```

nsubsp vs nislands
```{r}
df_melanesia %>% 
  ggplot(aes(x=log(npoly),y=nsubsp))+
  geom_point()+
  geom_smooth(method="lm", color="black")+
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, face= "italic", ),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(),
    axis.ticks.y = element_blank())+
  labs(title="Northern Melanesia\n", x="\nNumber of islands (log)\n", y="\nGSI\n")
```


Figure 1 - Continuous plot
```{r}
plot1 <- df_melanesia %>% 
  filter(nsubsp>1) %>% filter(nsubsp<npoly) %>% 
  ggplot(aes(x=fct_reorder(species_name, gsi),y=gsi))+
  geom_point(color="#665480")+
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, face= "italic", ),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(angle=90),
    axis.ticks.y = element_blank())+
  labs(title="Northern Melanesia\n", x="\n\n", y="\nGSI\n")+gghighlight(species_name %in% md_total_mel$species_name)

plot2 <- df_world %>% 
  filter(nsubsp>2) %>% filter(nsubsp<npoly) %>% 
  ggplot(aes(x=fct_reorder(species_name, gsi),y=gsi))+
  geom_jitter(color="#665480")+
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, face= "italic", ),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(angle=90),
    axis.ticks.y = element_blank())+
  labs(title="Global Island\n", x="\n \n", y="\nGSI\n")+expand_limits(x= c(-5, length(levels(df_world$species_name)) + 699))

plot3 <- df_antilles %>% 
  filter(nsubsp>1) %>% filter(nsubsp<npoly) %>% 
  ggplot(aes(x=fct_reorder(species_name, gsi),y=gsi))+
  geom_jitter(color="#665480")+
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, face= "italic", ),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(angle=90),
    axis.ticks.y = element_blank())+
  labs(title="Antilles\n", x="\n \n", y="\nGSI\n")

plot4 <- df_hawaii %>% 
 filter(nsubsp>1) %>% filter(nsubsp<npoly) %>% 
  ggplot(aes(x=fct_reorder(species_name, gsi),y=gsi))+
  geom_jitter(color="#665480")+
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, face= "italic", ),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(angle=90),
    axis.ticks.y = element_blank())+
  labs(title="Hawaii\n", x="\n \n", y="\nGSI\n")

plot5 <- plot2/plot1/plot3/plot4

plot5

ggsave(
  plot=plot5,
  filename = "fig1.pdf",
  path = figures_path,
  device="pdf",
  scale=0.5,
  width = 30,
  height = 50,
  dpi = 400,
  units = "cm"
)

```

Figure 2 - Top 15
```{r}
plot6 <- df_melanesia %>% 
  filter(nsubsp>2) %>% 
  top_n(gsi, n=20) %>% filter(nsubsp<npoly) %>% 
  ggplot(aes(x=fct_reorder(species_name, gsi),y=gsi))+
  geom_point(color="#4e9cbf")+
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    #axis.text.x = element_blank(),
    axis.text.x = element_text(vjust = 0.9,hjust=1, angle=45, face= "italic", size=12),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(angle=90),
    axis.ticks.y = element_blank(),
    plot.margin = margin(1, 1, 1, 1, "cm"),
    plot.title=element_text(size=14))+
  labs(title="Northern Melanesia\n", x="\n\n", y="\nGSI\n", size=12)+gghighlight(species_name %in% md_total_mel$species_name)

plot7 <- df_world %>% 
  filter(nsubsp>2) %>% 
  top_n(gsi, n=20) %>% filter(nsubsp<npoly) %>% 
  ggplot(aes(x=fct_reorder(species_name, gsi),y=gsi))+
  geom_jitter(color="#4e9cbf")+
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    #axis.text.x = element_blank(),
    axis.text.x = element_text(vjust = 0.9,hjust=1, angle = 45, face= "italic", size=12),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(angle=90),
    axis.ticks.y = element_blank(),
    plot.margin = margin(1, 1, 1, 0.5, "cm"),
    plot.title=element_text(size=14))+
  labs(title="Global Island\n", x="\n \n", y="\nGSI\n")#+expand_limits(x= c(-5, length(levels(df_world$species_name)) + 699))

plot8 <- df_antilles %>% 
  filter(nsubsp>2) %>% 
  top_n(gsi, n=20) %>% filter(nsubsp<npoly) %>% 
  ggplot(aes(x=fct_reorder(species_name, gsi),y=gsi))+
  geom_point(color="#4e9cbf")+
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    #axis.text.x = element_blank(),
    axis.text.x = element_text(vjust = 0.9,hjust=1, angle=45, face= "italic", size=12),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(angle=90),
    axis.ticks.y = element_blank(),
    plot.margin = margin(1, 1, 1, 1, "cm"),
    plot.title=element_text(size=14))+
  labs(title="Antilles\n", x="\n\n", y="\nGSI\n", size=12)

plot9 <- df_hawaii %>% 
  filter(nsubsp>1) %>% 
  top_n(gsi, n=20) %>% filter(nsubsp<npoly) %>% 
  ggplot(aes(x=fct_reorder(species_name, gsi),y=gsi))+
  geom_point(color="#4e9cbf")+
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    #axis.text.x = element_blank(),
    axis.text.x = element_text(vjust = 0.9,hjust=1, angle=45, face= "italic", size=12),
    axis.text.y = element_text(),
    axis.title.x = element_text(),
    axis.title.y = element_text(angle=90),
    axis.ticks.y = element_blank(),
    plot.margin = margin(1, 1, 1, 1, "cm"),
    plot.title=element_text(size=14))+
  labs(title="Hawaii\n", x="\n\n", y="\nGSI\n", size=12)

plot10 <- plot7 / plot6 / plot8 / plot9

ggsave(
  plot=plot10,
  filename = "fig2.pdf",
  path = figures_path,
  device="pdf",
  scale=1,
  width = 19,
  height = 44,
  dpi = 400,
  units = "cm"
)
```

Figures 3, 4 and 5 - Plots brms global
```{r}
range <- plot_model(mod_world_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_log_max")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nRange size")

temperature <- plot_model(mod_world_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_temperature_range")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nTemperature range")

median_log <- plot_model(mod_world_logit, type="eff", title="",ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_log_median")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nMedian distance among islands")

body <- plot_model(mod_world_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_body_mass_log")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nBody mass")


precip <- plot_model(mod_world_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_precipitation_range")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nPrecipitation range")

netdiv <- plot_model(mod_world_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_netdiv")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nDiversification rate")

hwi <- plot_model(mod_world_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_hwi")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nHWI")

alt <- plot_model(mod_world_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_alt_median")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nMedian altitude")

lat <- plot_model(mod_world_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_latitude")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nLatitude")

migration <- plot_model(mod_world_logit, type="eff",pred.type = "fe", ppd=T, title="",ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="migration")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               axis.text.x = element_text(size= 15, vjust = 0.9,hjust=1, angle=45),
               plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm")))+labs(y="\nResidual\n", size=15)

habitat <- plot_model(mod_world_logit, type="eff",pred.type = "fe", ppd=T, title="",ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="habitat")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               axis.text.x = element_text(size= 15, vjust = 0.9,hjust=1, angle=45),
               plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm")))+labs(y="\nResidual\n", size=15)

realm <- plot_model(mod_world_logit, type="eff",pred.type = "fe", ppd=T, title="",ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="Realm")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               axis.text.x = element_text(size= 15, vjust = 0.9,hjust=1, angle=45),
               plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm")))+labs(y="\nResidual\n", size=15)

plot7 <- (range+median_log+lat)/(precip+temperature+alt)/(hwi+body) +plot_annotation(title="Global Island")
plot8 <- (lat+alt)+plot_annotation(title="Global Island")
plot9 <- habitat/migration/realm+plot_annotation(title="Global Island")

ggsave(
  plot=plot7,
  filename = "fig3.pdf",
  path = figures_path,
  device="pdf",
  scale=1,
  width = 23,
  height = 18,
  dpi = 400,
  units = "cm"
)

ggsave(
  plot=plot8,
  filename = "fig4.png",
  path = figures_path,
  device="png",
  scale=1,
  width = 20,
  height = 10,
  dpi = 400,
  units = "cm"
)

ggsave(
  plot=plot9,
  filename = "fig5.png",
  path = figures_path,
  device="png",
  scale=1,
  width = 20,
  height = 30,
  dpi = 400,
  units = "cm"
)

```

Figures 6 and 7 - Plots brms Mel
```{r}
range <- plot_model(mod_melanesia_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_log_max")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nRange size")

temperature <- plot_model(mod_melanesia_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_temperature_range")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nTemperature range")

median_log <- plot_model(mod_melanesia_logit, type="eff", title="",ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_log_median")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nMedian distance among islands")

body <- plot_model(mod_melanesia_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_body_mass_log")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nBody mass")


precip <- plot_model(mod_melanesia_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_precipitation_range")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nPrecipitation range")

netdiv <- plot_model(mod_melanesia_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_netdiv")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nDiversification rate")

hwi <- plot_model(mod_melanesia_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_hwi")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nHWI")

alt <- plot_model(mod_melanesia_logit, type="eff", title="", ppd=T,ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="norm_alt_median")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank()))+labs(y="\nResidual\n", x="\nMedian altitude")

migration <- plot_model(mod_melanesia_logit, type="eff",pred.type = "fe", ppd=T, title="",ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="migration")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               axis.text.x = element_text(size=12, vjust = 0.9,hjust=1, angle=45),
               plot.margin = margin(2, 2, 2,2, "cm")))+labs(y="\nResidual\n", x="")

habitat <- plot_model(mod_melanesia_logit, type="eff",pred.type = "fe", ppd=T, title="",ci.lvl = 0.89,grid.breaks = F, grid=FALSE, terms="habitat")+theme_set(theme(
               panel.grid.major = element_blank(),
               panel.grid.minor = element_blank(),
               axis.ticks.x = element_blank(),
               axis.ticks.y = element_blank(),
               axis.text.x = element_text(size=12, vjust = 0.9,hjust=1, angle=45),
               plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm")))+labs(y="\nResidual\n", x="")

plot10 <- (range+alt+temperature)/(precip+median_log)/(hwi+body) +plot_annotation(title="Northern Melanesia")
plot11 <- habitat/migration+plot_annotation(title="Northern Melanesia")

ggsave(
  plot=plot10,
  filename = "fig6.pdf",
  path = figures_path,
  device="pdf",
  scale=1,
  width = 18,
  height = 15,
  dpi = 400,
  units = "cm"
)

ggsave(
  plot=plot11,
  filename = "fig7.pdf",
  path = figures_path,
  device="pdf",
  scale=1,
  width = 20,
  height = 25,
  dpi = 400,
  units = "cm"
)
```

Figure 8 - brms effects global
```{r}
list_realms <- c("norm_log_max", "norm_log_median", "norm_latitude", "RealmAntarctic", "RealmAustralian","RealmIndo_Malay", "Realm_Madagascar","RealmNearctic", "RealmNeotropic", "RealmOceania", "RealmPalearctic")

list_abiotic <- c("norm_precipitation_range", "norm_temperature_range", "norm_alt_median")

list_species_attr <- c("norm_hwi", "norm_netdiv", "norm_body_mass_log","migrationfullnomad","migrationfullresident","migrationfullresident","migrationmarine","migrationpartialdirectionalmigrant","migrationpartialdispersivemigrant","migrationpartialdispersivemigrant", "migrationpartialnomad", "migrationpartialresident")

plot_coefficients_realm <- function(dataset, list_vars){
    plot_model(dataset, 
              sort.est = T, 
              title = "", 
              ppd=T,
              axis.labels = "",
              bpe = "median",
              bpe.style = "dot",
              bpe.color = "black",
              prob.inner = .4,
              prob.outer = .8,
              colors =c("#424242","#828282"),
              show.values =T,
              vline.color = "grey", 
              terms=list_vars)+theme(
              panel.grid.major = element_blank(),
              panel.grid.minor = element_blank(),
              axis.ticks.x = element_blank(),
              axis.ticks.y = element_blank(),
              axis.text.x = element_text(size= text_size, vjust = 0.9,hjust=1, family="Ubuntu"),
              axis.text.y = element_text(size= text_size, vjust = 0.9,hjust=1, family="Ubuntu"),
              axis.title.x = element_text(family="Ubuntu"),
              axis.title.y = element_text(family="Ubuntu"))+
              scale_x_discrete(labels = c("Range size",
                                          "Latitude",
                                          "Realm - Nearctic",
                                          "Realm - Palearctic",
                                          "Realm - Neotropic",
                                          "Realm - Indo Malayan", 
                                          "Realm - Antarctic",
                                          "Realm - Australian",
                                          "Realm - Oceania",
                                          "Median distance among islands"))+
              labs(title="Biogeographic variables", family="Ubuntu")
          }

realm_plot <- plot_coefficients_realm(mod_world_logit, list_realms)

plot_coefficients_abiotic <- function(dataset, list_vars){plot_model(dataset, sort.est = T, title = "", axis.labels = "",bpe = "median",bpe.style = "dot",bpe.color = "black",
    ppd=T,
    prob.inner = .4,
    prob.outer = .8,
    colors =c("#424242","#828282"),
    show.values =T,
    vline.color = "grey",
    terms=list_vars)+theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size= text_size, vjust = 0.9,hjust=1, family="Ubuntu"),
    axis.text.y = element_text(size= text_size, vjust = 0.9,hjust=1, family="Ubuntu"),
    axis.title.x = element_text(family="Ubuntu"),
    axis.title.y = element_text(family="Ubuntu"))+
    scale_x_discrete(labels = c("Temperature range",
                                "Median altitude",
                                "Precipitation range"))+labs(title="Abiotic variables", family="Ubuntu")
}

abio_plot <- plot_coefficients_abiotic(mod_world_logit, list_abiotic)

plot_coefficients_sp <- function(dataset, list_vars){plot_model(dataset, sort.est = T, title = "", axis.labels = "",bpe = "median",bpe.style = "dot",bpe.color = "black",
    prob.inner = .4,
    ppd=T,
    prob.outer = .8,
    colors =c("#424242","#828282"),
    show.values =T,
    vline.color = "grey",
    terms=list_vars)+theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size= text_size, vjust = 0.9,hjust=1, family="Ubuntu"),
    axis.text.y = element_text(size= text_size, vjust = 0.9,hjust=1, family="Ubuntu"),
    axis.title.x = element_text(family="Ubuntu"),
    axis.title.y = element_text(family="Ubuntu"))+
    scale_x_discrete(labels = c("Body mass (log)",
                                "Migration - Marine",
                                "Hand Wing Index",
                                "Migration - Full nomad",
                                "Migration - Partial directional migrant",
                                 "Diversification rate",
                                "Migration - Partial dispersive migrant",
                                "Migration - Full resident",
                                "Migration - Partial nomad",
                                "Migration - Partial resident"
                                ))+labs(title="Species attributes", family="Ubuntu")
}

sp_plot <- plot_coefficients_sp(mod_world_logit, list_species_attr)

plot12 <- abio_plot/(sp_plot+realm_plot)+ plot_annotation(tag_levels = 'A', title="Global Island")

ggsave(
  plot=plot12,
  filename = "fig8.png",
  path = figures_path,
  device="png",
  scale=0.5,
  width = 50,
  height = 50,
  dpi = 400,
  units = "cm"
)
```


Figure 8 - brms effects Mel
```{r}
list_realms <- c("norm_log_max", "norm_log_median")

list_abiotic <- c("norm_precipitation_range", "norm_temperature_range", "norm_alt_median")

list_species_attr <- c("norm_hwi", "norm_netdiv", "norm_body_mass_log","migrationfullnomad","migrationfullresident","migrationfullresident","migrationmarine","migrationpartialdirectionalmigrant","migrationpartialdispersivemigrant","migrationpartialdispersivemigrant", "migrationpartialnomad", "migrationpartialresident")

plot_coefficients_realm <- function(dataset, list_vars) {
  plot_model(
    dataset,
    sort.est = T,
    title = "",
    ppd=T,
    axis.labels = "",
    bpe = "median",
    bpe.style = "dot",
    bpe.color = "black",
    prob.inner = .4,
    prob.outer = .8,
    colors = c("#424242", "#828282"),
    show.values = T,
    vline.color = "grey",
    terms = list_vars
  ) + theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(
      size = text_size,
      vjust = 0.9,
      hjust = 1,
      family = "Ubuntu"
    ),
    axis.text.y = element_text(
      size = text_size,
      vjust = 0.9,
      hjust = 1,
      family = "Ubuntu"
    ),
    axis.title.x = element_text(family = "Ubuntu"),
    axis.title.y = element_text(family = "Ubuntu")
  ) +
    scale_x_discrete(labels = c("Median distance among islands",
                                "Range size")) +
    labs(title = "Biogeographic variables", family = "Ubuntu")
}

realm_plot_mel <- plot_coefficients_realm(mod_melanesia_logit, list_realms)

plot_coefficients_abiotic <-
  function(dataset, list_vars) {
    plot_model(
      dataset,
      sort.est = T,
      title = "",
      ppd=T,
      axis.labels = "",
      bpe = "median",
      bpe.style = "dot",
      bpe.color = "black",
      prob.inner = .4,
      prob.outer = .8,
      colors = c("#424242", "#828282"),
      show.values = T,
      vline.color = "grey",
      terms = list_vars
    )+ theme(
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      axis.ticks.x = element_blank(),
      axis.ticks.y = element_blank(),
      axis.text.x = element_text(
        size = text_size,
        vjust = 0.9,
        hjust = 1,
        family = "Ubuntu"
      ),
      axis.text.y = element_text(
        size = text_size,
        vjust = 0.9,
        hjust = 1,
        family = "Ubuntu"
      ),
      axis.title.x = element_text(family = "Ubuntu"),
      axis.title.y = element_text(family = "Ubuntu")
    ) +
      scale_x_discrete(labels = c("Temperature range",
                                  "Precipitation range",
                                  "Median altitude")) + labs(title = "Abiotic variables", family =
                                                                 "Ubuntu")
  }

abio_plot_mel <- plot_coefficients_abiotic(mod_melanesia_logit, list_abiotic)

plot_coefficients_sp <- function(dataset, list_vars){plot_model(dataset, sort.est = T, title = "", axis.labels = "",bpe = "median",bpe.style = "dot",bpe.color = "black",
    prob.inner = .4,
    ppd=T,
    prob.outer = .8,
    colors =c("#424242","#828282"),
    show.values =T,
    vline.color = "grey",
    terms=list_vars)+theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    axis.text.x = element_text(size= text_size, vjust = 0.9,hjust=1, family="Ubuntu"),
    axis.text.y = element_text(size= text_size, vjust = 0.9,hjust=1, family="Ubuntu"),
    axis.title.x = element_text(family="Ubuntu"),
    axis.title.y = element_text(family="Ubuntu"))+
    scale_x_discrete(labels = c("Body mass (log)",
                                "Migration - Partial nomad",
                                "Diversification rate",
                                "Migration - Marine",
                                "Migration - Partial directional migrant",
                                "Hand Wing Index",
                                "Migration - Partial dispersive migrant",
                                "Migration - Full resident",
                                "Migration - Partial resident"
                                ))+
    labs(title="Species attributes", family="Ubuntu")
}

sp_plot_mel <- plot_coefficients_sp(mod_melanesia_logit, list_species_attr)

plot13 <- sp_plot_mel+(abio_plot_mel/realm_plot_mel)+plot_layout(ncol = 2)+ plot_annotation(tag_levels = 'A', title="Northern Melanesia")

ggsave(
  plot=plot13,
  filename = "fig9.png",
  path = figures_path,
  device="png",
  scale=0.5,
  width = 50,
  height = 30,
  dpi = 400,
  units = "cm"
)
```

Interpret coefficients
```{r}
coef_mel <- exp(fixef(mod_melanesia_logit, probs = c(0.11, 0.89)))
coef_world <- exp(fixef(mod_world_logit, probs = c(0.11, 0.89)))

write.csv(coef_mel, "coef_mel.csv", row.names = T)
write.csv(coef_world, "coef_world.csv", row.names = T)
```

Nilo's plots
```{r}
get_variables(mod_world_logit)
posteriors = posterior_samples(mod_world_logit) %>%
  gather() %>%
  mutate(key = factor(key)) %>%
  filter(key != "b_Intercept", 
         !grepl("r_tree_name",key), 
         !grepl("z_1",key), 
         !grepl("prior",key),
         !grepl("sd_",key),
         !grepl("lp__",key),
         !grepl("sigma",key))

posteriors_migration = posterior_samples(mod_world_logit) %>%
  gather() %>%
  mutate(key == factor(key)) %>%
  filter(grepl("migration",key),
         !grepl("prior", key))

posteriors_quant = posterior_samples(mod_world_logit) %>%
  gather() %>%
  mutate(key == factor(key)) %>%
  filter(grepl("norm_",key),
         !grepl("prior", key))

posteriors_realm = posterior_samples(mod_world_logit) %>%
  gather() %>%
  mutate(key == factor(key)) %>%
  filter(grepl("Realm",key),
         !grepl("prior", key))

plot14 <- posteriors_migration %>%
  ggplot(aes(x = value, y = fct_reorder(key,value))) +
  geom_vline(xintercept = 0, color = "white") +
  stat_dotsinterval(point_interval = 
                      mode_hdi, 
                    .width = c(.89, .11), 
                    position = "dodge", 
                    quantiles = 100,
                    slab_color="#ba2d02",
                    fill="#ba2d02")+
  theme(panel.grid = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_text(size= 15),
        axis.text.y = element_text(size= 15)) +
  coord_cartesian(xlim = c(-0.5,0.5)) + scale_y_discrete(labels = c("Marine",
                                                                    "Full nomad",
                                                                    "Partial directional migrant",
                                                                    "Full resident",
                                                                    "Partial nomad",
                                                                    "Partial dispersive migrant",
                                                                    "Partial resident"))

plot15 <- posteriors_realm %>%
  ggplot(aes(x = value, y = fct_reorder(key,value))) +
  geom_vline(xintercept = 0, color = "white") +
  stat_dotsinterval(point_interval = 
                      mode_hdi, 
                    .width = c(.89, .11), 
                    position = "dodge", 
                    quantiles = 100,
                    slab_color="#b6ba3d",
                    fill="#b6ba3d")+
  theme(panel.grid = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_text(size= 15),
        axis.text.y = element_text(size= 15)) +
  coord_cartesian(xlim = c(-0.5,0.5)) + scale_y_discrete(labels = c("Nearctic",
                                                                  "Antarctic",
                                                                  "Palearctic",
                                                                  "Neotropic",
                                                                  "Australian",
                                                                  "Indo Malay",
                                                                  "Oceania",
                                                                  "Madagascar"))
plot16 <- 
  posteriors_quant %>%
  ggplot(aes(x = value, y = fct_reorder(key,value))) +
  geom_vline(xintercept = 0, color = "white") +
  stat_dotsinterval(point_interval = 
                      mode_hdi,
                    slab_color="#048ba8",
                    fill="#048ba8",
                    .width = c(.89, .11), 
                    position = "dodge", 
                    quantiles = 100)+
  theme(panel.grid = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_text(size= 15),
        axis.text.y = element_text(size= 15)
        ) +
  coord_cartesian(xlim = c(-1.2,0.5)) + scale_y_discrete(labels = c("Range size",
                                                                  "Latitude",
                                                                  "Body mass",
                                                                  "HWI",
                                                                  "Diversification rate",
                                                                  "Temperature range",
                                                                  "Median distance among islands",
                                                                  "Precipitation range",
                                                                  "Median altitude"))
effect_global <- 
  plot16/
  (plot14+
  plot15)+
  plot_annotation(title="Global Island\n", theme = theme(plot.title = element_text(size = 16)))

effect_global

ggsave(
  plot=effect_global,
  filename = "effect_global.pdf",
  path = figures_path,
  device="pdf",
  scale=0.5,
  width = 70,
  height = 50,
  dpi = 400,
  units = "cm"
)
```

```{r}
posteriors_migration = posterior_samples(mod_melanesia_logit) %>%
  gather() %>%
  mutate(key == factor(key)) %>%
  filter(grepl("migration",key),
         !grepl("prior", key))

posteriors_quant = posterior_samples(mod_melanesia_logit) %>%
  gather() %>%
  mutate(key == factor(key)) %>%
  filter(grepl("norm_",key),
         !grepl("prior", key))


plot17 <- posteriors_migration %>%
  ggplot(aes(x = value, y = fct_reorder(key,value))) +
  geom_vline(xintercept = 0, color = "white") +
  stat_dotsinterval(point_interval = 
                      mode_hdi, 
                    .width = c(.89, .11), 
                    position = "dodge", 
                    quantiles = 100,
                    slab_color="#4c956c",
                    fill="#4c956c")+
  theme(panel.grid = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_text(size= 13),
        axis.text.y = element_text(size= 13)) +
  coord_cartesian(xlim = c(-3,3)) + scale_y_discrete(labels = c("Marine",
                                                                "Partial nomad",
                                                                "Partial directional migrant", 
                                                                "Partial dispersive migrant",
                                                                "Full resident",
                                                                "Partial resident"))

plot18 <- 
  posteriors_quant %>%
  ggplot(aes(x = value, y = fct_reorder(key,value))) +
  geom_vline(xintercept = 0, color = "white") +
  stat_dotsinterval(point_interval = 
                      mode_hdi,
                    .width = c(.89, .11), 
                    position = "dodge", 
                    quantiles = 100,
                    slab_color="#ba2d02",
                    fill="#ba2d02")+
  theme(panel.grid = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text.x = element_text(size= 13),
        axis.text.y = element_text(size= 13)
        ) +
  coord_cartesian(xlim = c(-3,3)) + scale_y_discrete(labels = c("Body mass",
                                                                "Median distance among islands",
                                                                "Precipitation range",
                                                                "Diversification rate",
                                                                "HWI",
                                                                "Range size",
                                                                "Temperature range",
                                                                "Median altitude"))
effect_mel <- 
  plot17+
  plot18+
  plot_annotation(title="Northern Melanesia\n")+theme(title = element_text(size=15,face = "bold"))

effect_mel

ggsave(
  plot=effect_mel,
  filename = "effect_mel.pdf",
  path = figures_path,
  device="pdf",
  scale=0.5,
  width = 60,
  height = 35,
  dpi = 400,
  units = "cm"
)
```


```{r}

me <- conditional_effects(mod_world_logit,
  effects = "norm_log_max",
  spaghetti = T,
  points = T,
  nsamples = 500,
  resolution = 100,
  method = "fitted")

plot(me)[[1]]+
  scale_color_grey() +
  scale_fill_grey()


m2_interaction_condeffs = conditional_effects(
  mod_world_logit,
  effects = "norm_log_max",
  spaghetti = T,
  points = T,
  nsamples = 500,
  resolution = 100,
  method = "fitted"
)

ggplot(
  attr(m2_interaction_condeffs$norm_log_max, "spaghetti"),
  aes(
    x = effect1__,
    y = estimate__,
    group = sample__
  )
) +
  geom_line(alpha = .2, size = .4) +
  geom_smooth(
    # smooth jagged mean line (change to geom_line
    # to see that it has no effect otherwise)
    data = m2_interaction_condeffs$norm_log_max,
    aes(group = effect1__),
    alpha = .8,
    size = .8
  ) 


posteriors = posterior_samples(mod_melanesia_logit) %>%
  gather() %>%
  mutate(key == factor(key)) %>%
  filter(grepl("norm_",key),
         !grepl("prior", key)) 

p <- mod_melanesia_logit$data %>%
  add_predicted_draws(model=mod_melanesia_logit, n =10, value="norm_hwi") 
p <-p[c(1:64000),]


t <- cbind(posteriors, p)
  ggplot(data=mod_melanesia_logit$data, aes(x = norm_body_mass_log, y = norm_residual)) +
  tat_lineribbon(aes(y = b_norm_hwi), .width = c(.99, .95, .8, .5),  color = "#08519C")
  
mod_melanesia_logit$data %>%
  # group_by(migration) %>% 
   # data_grid(
   #   new = seq_range(norm_hwi, n = 100),
   #           .model = mod_melanesia_logit$data) %>%
  add_predicted_draws(model=mod_melanesia_logit, n=100, value="norm_body_mass") %>% 
  ggplot(aes(x = norm_body_mass_log, y = norm_residual)) +
  stat_lineribbon(aes(y = .prediction), .width = c(.99, .95, .8, .5),  color = "#08519C") +
  geom_point(data=mod_melanesia_logit$data, aes(x=norm_hwi))+
  scale_fill_brewer(palette = "Greys") 


mod_melanesia_logit %>%
  emmeans( ~ norm_hwi) %>%
  gather_emmeans_draws() %>%
  ggplot(aes(x = .value, y = norm_hwi)) +
  geom_point()

pred <- predict(mod_melanesia_logit, probs=c(0.11, 0.89))

t <- cbind(mod_melanesia_logit$data, pred)

t %>% 
  ggplot(aes(x=norm_hwi,y=Estimate))+geom_point()

mod_world_logit %>% 
  spread_draws(r_tree_name[term, group])
posteriors_migration = posterior_samples(mod_melanesia_logit) %>%
  gather() %>%
  mutate(key == factor(key)) %>%
  filter(grepl("migration",key),
         !grepl("prior", key))

```

```{r}
world <- sf::st_read(file.path(data_path, "shapefiles", "everythingisanisland.shp")) %>% 
  mutate(area = st_area(.) / 1000000) %>% 
  drop_units() %>% 
  filter(area < 587000) %>% 
  st_set_crs(., 4326)

oceania <- sf::st_read(file.path(data_path, "shapefiles", "northernmelanesia.shp")) %>% 
  mutate(area = st_area(.) / 1000000) %>% 
  drop_units() %>% 
  filter(area < 587000) %>% 
  st_set_crs(., 4326)

oceania <-
  ne_countries(scale = "large",
               returnclass = "sf",
               continent = "oceania")

world <-
  ne_countries(scale = "large",
               returnclass = "sf") %>% st_set_crs(., 4326)

northern_melanesia <- ggplot(data = oceania) +
  geom_sf(color="grey", fill="grey") +
  coord_sf(
    xlim = c(143, 165),
    ylim = c(-13, 0),
    expand = FALSE
  ) +
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, angle = 45, face= "italic"),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank())

world_map <- ggplot(data = world) +
  geom_sf(color="grey", fill="grey") +
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, angle = 45, face= "italic"),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank())

both_maps <- world_map+northern_melanesia
ggannotate::ggannotate(both_maps)

ggsave(
  plot=northern_melanesia,
  filename = "northern_melanesia.pdf",
  path = figures_path,
  device="pdf",
  scale=0.5,
  width = 40,
  height = 20,
  dpi = 400,
  units = "cm"
)

antilles_map <- ggplot(data = world) +
  geom_sf(color="grey", fill="grey") +
  coord_sf(
    xlim = c(-90, -60),
    ylim = c(11, 28),
    expand = FALSE
  ) +
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, angle = 45, face= "italic"),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank())

hawaii_map <- ggplot(data = world) +
  geom_sf(color="grey", fill="grey") +
  coord_sf(
    xlim = c(-165, -150),
    ylim = c(16, 25),
    expand = FALSE
  ) +
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, angle = 45, face= "italic"),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank())

two_maps <- antilles_map + hawaii_map

ggsave(
  plot=two_maps,
  filename = "two_maps.pdf",
  path = figures_path,
  device="pdf",
  scale=0.5,
  width = 40,
  height = 20,
  dpi = 400,
  units = "cm"
)
```

Silvereye distribution
```{r}
silvereye <-
  sf::st_read(dsn = "/home/zoo/sjoh4959/silvereye.shp") %>%st_set_crs(., 4326)

plot(silvereye$geometry)+
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, angle = 45, face= "italic"),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank())

intersection_silvereye <- st_intersection(silvereye, world)

silvereye_distr <- ggplot(data = intersection_silvereye) +
  geom_sf(color="#6a5f73", fill="#6a5f73") +
  coord_sf(
    xlim = c(110, 185),
    ylim = c(-55, -5),
    expand = FALSE
  ) +
  theme(
    plot.title = element_text(size=text_size),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    axis.ticks.x = element_blank(),
    axis.text.x = element_blank(),
    #axis.text.x = element_text(vjust = 0.9,hjust=1, angle = 45, face= "italic"),
    axis.text.y = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.ticks.y = element_blank())

ggsave(
  plot=silvereye_distr,
  filename = "silvereye_distr.pdf",
  path = figures_path,
  device="pdf",
  scale=0.5,
  width = 40,
  height = 20,
  dpi = 400,
  units = "cm"
)


```


```{r}

fixef_report <- knitr::kable(fixef(mod_melanesia_logit, probs = c(0.11, 0.89)),digits = 2)
```
